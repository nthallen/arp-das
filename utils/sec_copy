#! /bin/sh
# sec_copy <tgtnode>
# example: sec_copy radflt

if [ `id -u` != 0 ]; then
  exec /usr/pkg/bin/sudo $0 $*
fi

function nl_error {
  echo "pkg_copy: $*" >&2
  exit 1
}

scrnode=''
if [ -n "$2" ]; then
  srcnode=/net/$1
  shift
fi
tgtnode=$1
shift

[ -z "$tgtnode" ] && nl_error "Usage: sec_copy [<srcnode>] <tgtnode>"
[ -d /net/$tgtnode/ ] || nl_error "Cannot locate target node /net/$tgtnode"
ok=`on -f $tgtnode echo OK 2>&1`
[ "$ok" = "OK" ] || nl_error "$ok"

cp -vn $srcnode/etc/passwd $srcnode/etc/group $srcnode/etc/shadow /net/$tgtnode/etc
on -f $tgtnode mkdir -p /usr/pkg/etc
cp -vn $srcnode/usr/pkg/etc/sudoers /net/$tgtnode/usr/pkg/etc/
cp -vn $srcnode/etc/profile.d/pkg.sh /net/$tgtnode/etc/profile.d
ln -s pkg.sh /net/$tgtnode/etc/profile.d/pkg.ksh

